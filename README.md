# SWAT Global Sensitivity Analysis Using the Morris Method With Machine Learning Surrogate Modeling

This repository provides a complete, unified workflow for performing global sensitivity analysis of the SWAT (Soil and Water Assessment Tool) hydrological model using the Morris Elementary Effects Method, extended with a machine learning surrogate model based on Random Forest regression. The combined physics–data framework enables a detailed evaluation of hydrological parameter influence while offering a computationally efficient surrogate for SWAT behavior.

---

## 1. Overview

SWAT contains numerous hydrologic parameters controlling surface runoff, baseflow, soil moisture, infiltration, snow processes, and channel routing. Understanding how these parameters affect streamflow behavior is essential for model diagnosis, uncertainty quantification, and watershed analysis.

This project includes:

### • Global Sensitivity Analysis (GSA)
- Morris One-at-a-Time sampling of 12 hydrological parameters  
- More than 3000 parameter trajectories  
- Automatic modification of SWAT input files  
- Batch execution of the SWAT model  
- Extraction of generated discharge from `output.rch`  
- Evaluation using:
  - Nash–Sutcliffe Efficiency (NSE)
  - Streamflow Range (Max–Min)

### • Machine Learning Surrogate Modeling
- Random Forest regressors trained on Morris-based samples  
- Prediction of NSE and flow range using only parameters  
- ML-based feature importance  
- Ensemble-based uncertainty quantification

This hybrid approach provides fast SWAT emulation and parameter influence evaluation suitable for research and academic studies.

---

## 2. Repository Structure

```
SWAT-Parameter-Sensitivity-ML-Surrogate
│
├── data/
│   ├── Observed Streamflow.xlsx          # Observed discharge data
│   ├── TxtInOut/                         # User-provided SWAT project directory
│   └── output.rch                        # Generated by SWAT after each run
│
├── swat_morris_ml.ipynb                  # Full workflow (Morris + ML surrogate)
├── README.md                             # Project documentation
└── .gitignore                            # Excludes SWAT executables and large files
```

---

## 3. Important Notes About SWAT Files

Due to SWAT licensing policies, the following items **cannot** be included in this repository:

- `swat2012.exe`
- Complete `TxtInOut/` folder

Users must place the following items inside `data/` before running the notebook:

- Observed streamflow file (`Observed Streamflow.xlsx`)
- SWAT executable (`swat2012.exe`)
- Their own `TxtInOut/` directory

---

## 4. How to Run the Project

### Step 1 — Clone
```bash
git clone https://github.com/HAMIDREZANASERIAN/SWAT-Parameter-Sensitivity-ML-Surrogate.git
```

### Step 2 — Enter project directory
```bash
cd SWAT-Parameter-Sensitivity-ML-Surrogate
```

### Step 3 — Launch Jupyter Notebook
```bash
jupyter notebook
```

### Step 4 — Open
```
swat_morris_ml.ipynb
```

Place the required files in:
```
data/
    TxtInOut/
    Observed Streamflow.xlsx
    swat2012.exe
```

---

## 5. Why NSE Is Frequently Low (or Negative) in Morris Sampling?

Low or negative NSE values during global sensitivity analysis are **expected** and scientifically correct.

During Morris sampling, parameter sets are drawn from wide, uncalibrated intervals. These random combinations are not optimized to match the watershed response, and therefore:

- They frequently produce poor hydrograph matches  
- NSE values can become negative  
- This does **not** indicate a model error  
- It reflects the natural behavior of SWAT under non-calibrated parameter conditions  

This is a standard characteristic of global sensitivity analysis in hydrology.

---

## 6. Machine Learning Surrogate Model

The Random Forest surrogate is trained on all Morris samples to predict SWAT performance using only input parameters. The model provides:

- Fast estimation of SWAT outputs without executing SWAT  
- Parameter importance ranking  
- Prediction uncertainty via ensemble variance  

This creates a powerful hybrid hydrological analysis pipeline combining deterministic physics and data-driven inference.

---

## 7. Interpretation of Results

Consistent trends observed from both Morris analysis and the surrogate model indicate:

- **GWQMN**, **GW_DELAY**, and **SOL_K** are dominant parameters affecting flow magnitude and variability  
- These parameters strongly influence groundwater contribution to streamflow  
- Parameters such as **SOL_AWC**, **SMFMN**, and **CN2** show minimal influence under the analyzed watershed conditions  
- Strong interactions (high Sigma) suggest nonlinear system behavior  

The ML surrogate confirms the physical sensitivity structure produced by SWAT, reinforcing the reliability of the analysis.

---

## 8. Applications

This project can be extended for:

- Sobol global sensitivity analysis  
- Bayesian calibration (GLUE, MCMC, DREAM)  
- Physics-informed machine learning  
- Scenario uncertainty studies  
- Climate/watershed management experiments  

---

## 9. Author

**Hamidreza Naserianhanzaei**  
Water Resources Management and Engineering

Email: hamidreza.naserianh@gmail.com

---

## 10. Citation

If using this repository for academic or research purposes, please cite or acknowledge the project accordingly.

